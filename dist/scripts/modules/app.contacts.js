
class AppContacts {
    constructor() {
        this.bindEvents()
    }

    //-----------------------------------------------------
    // Variables
    //-----------------------------------------------------

    container = document.querySelector('.js-contacts');
    buttonContactsAddress = this.container.querySelectorAll('.js-handle-contacts-address');
    mapControls = this.container.querySelectorAll('.js-contacts-map-control');
    contactsMapContainer = 'contacts-map';
    addressList = [
        {
            position: [56.748893, 60.742948],
            hint: 'г. Екатеринбург. Черняховского 100',
            description: {
                caption: 'Магазин на Черняховского',
                street: 'улица Черняховского, 100',
                phone: '+7 (999) 012-34-56',
                schedule: 'Ежедневно с 09:00 до 22:00'
            }
        },
        {
            position: [56.865259, 60.667983],
            hint: 'г. Екатеринбург. Блюхера 99',
            description: {
                caption: 'Магазин на Блюхера',
                street: 'улица Блюхера, 99',
                phone: '+7 (999) 012-34-56 (доб. 02)',
                schedule: 'Ежедневно с 10:00 до 21:00'
            }
        }
    ];

    //-----------------------------------------------------
    // Bind events
    //-----------------------------------------------------

    bindEvents() {
        ymaps.ready(() => {
            this.contactsMapInit()
        });
    }

    //-----------------------------------------------------
    // Methods
    //-----------------------------------------------------

    contactsMapInit = () => {
        const mobileModalBalloonContainer = document.querySelector('.js-modal-map-balloon');
        const mobileModalBalloonContent = mobileModalBalloonContainer.querySelector('.modal_wrapper');
        const showMobileModalBalloon = (description) => {
            mobileModalBalloonContainer.classList.add('active');
            mobileModalBalloonContent.innerHTML = this.getBalloonBody(description);
        };
        const movingMapToAddress = (mapPlacemark, address) => {
            // PS: Если увеличивать/приближать масштаб карты, то карта анимируется некрасиво, проблема яндекса, оставляю масштаб без изменения - "11"
            //map.setZoom(11);
            map.panTo(address.position, {
                duration: 800
            }).then(() => {
                mapPlacemark.balloon.open();
            });

            showMobileModalBalloon(address.description);
        };
        const handleClickMapControl = (button) => {
            const buttonMapControl = button.getAttribute('data-map-control');

            switch (buttonMapControl) {
                case 'up':
                    map.setZoom( map.getZoom() + 1 );
                    break;

                case 'down':
                    map.setZoom( map.getZoom() - 1 );
                    break;

                default: break;
            }
        };
        const map = new ymaps.Map(this.contactsMapContainer, {
                center: [56.8100, 60.7000],
                zoom: 11,
                controls: []
            }, {
                searchControlProvider: 'yandex#search'
            });

        map.behaviors.disable('scrollZoom');

        for ( let index = 0; index < this.addressList.length; index++ ) {
            const address = this.addressList[index];
            const balloonLayout = ymaps.templateLayoutFactory.createClass(this.getBalloonLayout(address), {
                build: function () {
                    balloonLayout.superclass.build.call(this);

                    const  mobileModalBalloonButtonClose = document.querySelectorAll('.js-contacts-map-balloon-close');

                    for ( let index = 0; index < mobileModalBalloonButtonClose.length; index++ ) {
                        mobileModalBalloonButtonClose[index].addEventListener('click', () => {
                            this.events.fire('userclose');

                            mobileModalBalloonContainer.classList.remove('active');
                        });
                    }
                }
            });

            const mapPlace = new ymaps.Placemark(address.position, {
                hintContent: address.hint
            }, {
                iconLayout: 'default#image',
                iconImageHref: 'images/contacts/marker.png',
                iconImageSize: [48, 54],
                iconImageOffset: [-24, -54],
                balloonLayout: balloonLayout,
            });

            mapPlace.events.add('click', () => showMobileModalBalloon(address.description));

            map.geoObjects.add(mapPlace);

            this.buttonContactsAddress[index].addEventListener('click', () => movingMapToAddress(mapPlace, address));
        }

        for ( let index = 0; index < this.mapControls.length; index++ ) {
            this.mapControls[index].addEventListener('click', function() { handleClickMapControl(this) });
        }
    };

    getBalloonLayout = ({description}) => {
        return `<div class="contacts_map-balloon">${this.getBalloonBody(description)}</div>`;
    };

    getBalloonBody = (description) => {
        return `<div>
                    <div class="contacts_map-balloon_close js-contacts-map-balloon-close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M5 19L12 12L19 19M19 5L11.9987 12L5 5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>                    
                    </div>

                    <div class="contacts_address-caption">${description.caption}</div>
                    <p>${description.street}</p>
                    <p>${description.phone}</p>
                    <p>${description.schedule}</p>
                      
                    <div class="contacts_map-balloon_build-route">
                        <div class="contacts_map-balloon_build-route_caption">
                            Построить маршрут                    
                        </div>
                                
                        <div class="contacts_map-balloon_build-route_controls">
                            <a href="/" class="button-secondary">
                                <div class="button-secondary_caption">
                                    <svg width="108" height="20" viewBox="0 0 114 20" fill="none">
                                        <mask id="mask0_3_13842" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="1" y="2" width="113" height="16">
                                        <path d="M113.252 2H1.25195V18H113.252V2Z" fill="white"/>
                                        </mask>
                                        <g mask="url(#mask0_3_13842)">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M16.9151 9.82985C16.9151 8.2799 16.4554 6.76477 15.5941 5.47611C14.7329 4.18745 13.5089 3.18316 12.0768 2.59028C10.6447 1.9974 9.06898 1.84257 7.54889 2.14536C6.02881 2.44815 4.63267 3.19497 3.53709 4.29135C2.44151 5.38772 1.6957 6.7844 1.39401 8.30471C1.09232 9.82501 1.24829 11.4006 1.84221 12.8323C2.43613 14.264 3.4413 15.4873 4.73058 16.3476C6.01986 17.2079 7.53533 17.6665 9.08528 17.6653C10.114 17.6653 11.1326 17.4626 12.0829 17.0688C13.0332 16.675 13.8966 16.0977 14.6238 15.37C15.3509 14.6424 15.9275 13.7786 16.3207 12.828C16.7138 11.8773 16.9158 10.8586 16.9151 9.82985Z" fill="#FC3F1D"/>
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M10.1289 6.43752H9.39131C8.0523 6.43752 7.37145 7.12405 7.37145 8.10561C7.37145 9.24036 7.85939 9.73398 8.83528 10.4205L9.6523 10.9879L7.32039 14.517H5.56152L7.67783 11.385C6.47499 10.5056 5.78847 9.68292 5.78847 8.25313C5.78847 6.45455 7.02535 5.25171 9.40833 5.25171H11.7573V14.517H10.1289V6.43752Z" fill="white"/>
                                        <path d="M35.2488 2.00073L19.2488 8.50299L26.2503 11.0033L28.7506 18.0007L35.2488 2.00073Z" fill="url(#paint0_linear_3_13842)"/>
                                        <path d="M35.2508 2.00073L26.0027 11.2529L28.7525 18.0007L35.2508 2.00073Z" fill="#FFCC00"/>
                                        <path d="M25.7511 11.5017L28.7506 17.9999L27.748 9.50069L19.2488 8.5022L25.7511 11.5017Z" fill="#ECA704"/>
                                        <path d="M39.2488 4.00073V15.7792H41.3862V10.6596H45.3717V15.7792H47.502V4.00073H45.3717V9.0661H41.3862V4.00073H39.2488ZM55.8963 9.96797C55.8963 7.89978 54.8029 7.11997 52.5809 7.11997C51.1912 7.11997 50.0979 7.54039 49.463 7.89978V9.57467C50.0273 9.16782 51.2618 8.72705 52.334 8.72705C53.3427 8.72705 53.8012 9.0661 53.8012 9.98153V10.4562H53.4626C50.2531 10.4562 48.8281 11.4733 48.8281 13.2025C48.8281 14.9316 49.9215 15.9013 51.5439 15.9013C52.7784 15.9013 53.3074 15.508 53.7095 15.1011H53.8012C53.8153 15.3249 53.8859 15.6097 53.9564 15.7792H56.0021C55.9315 15.0876 55.8963 14.3891 55.8963 13.6975V9.96797ZM53.8012 13.7449C53.5332 14.1179 53.0394 14.423 52.2987 14.423C51.417 14.423 50.9796 13.9484 50.9796 13.2228C50.9796 12.2531 51.6991 11.9005 53.4979 11.9005H53.8012V13.7449ZM61.2573 15.7792C63.3382 15.7792 64.5727 14.9316 64.5727 13.3042C64.5727 12.1853 63.8673 11.5412 62.6893 11.3377C63.6416 11.0868 64.2412 10.4426 64.2412 9.42549C64.2412 7.96759 63.2324 7.25559 61.2926 7.25559H57.5892V15.7792H61.2573ZM61.0457 8.7474C61.8075 8.7474 62.2308 9.0661 62.2308 9.73063C62.2308 10.3206 61.7723 10.68 60.9752 10.68H59.6349V8.7474H61.0457ZM61.081 12.1514C61.9839 12.1514 62.4565 12.4565 62.4565 13.1685C62.4565 13.9687 61.9274 14.2874 61.081 14.2874H59.6349V12.1514H61.081ZM65.9835 7.25559V15.7792H67.8528L71.0624 10.5104V15.7792H73.0939V7.25559H71.2246L68.0151 12.5244V7.25559H65.9835ZM74.8574 7.25559V15.7792H76.9525V8.84911H80.1973V7.25559H74.8574ZM87.5335 9.96797C87.5335 7.89978 86.4401 7.11997 84.2181 7.11997C82.8285 7.11997 81.7351 7.54039 81.1002 7.89978V9.57467C81.6646 9.16782 82.899 8.72705 83.9712 8.72705C84.9799 8.72705 85.4385 9.0661 85.4385 9.98153V10.4562H85.0999C81.8903 10.4562 80.4654 11.4733 80.4654 13.2025C80.4654 14.9316 81.5588 15.9013 83.1812 15.9013C84.4156 15.9013 84.9447 15.508 85.3468 15.1011H85.4385C85.4526 15.3249 85.5231 15.6097 85.5936 15.7792H87.6393C87.5688 15.0876 87.5335 14.3891 87.5335 13.6975V9.96797ZM85.4385 13.7449C85.1704 14.1179 84.6766 14.423 83.936 14.423C83.0542 14.423 82.6169 13.9484 82.6169 13.2228C82.6169 12.2531 83.3364 11.9005 85.1351 11.9005H85.4385V13.7449ZM95.4693 8.84911V7.25559H88.4364V8.84911H90.9053V15.7792H93.0004V8.84911H95.4693ZM99.7369 7.08606C97.4303 7.08606 95.822 8.65924 95.822 11.5276C95.822 14.3756 97.4303 15.9487 99.7369 15.9487C102.051 15.9487 103.652 14.3756 103.652 11.5072C103.652 8.65924 102.051 7.08606 99.7369 7.08606ZM99.7369 14.3552C98.573 14.3552 97.9946 13.494 97.9946 11.5276C97.9946 9.54077 98.573 8.67959 99.7369 8.67959C100.901 8.67959 101.487 9.54077 101.487 11.5072C101.487 13.494 100.901 14.3552 99.7369 14.3552ZM107.003 7.25559H105.063V18.2407H107.165V14.7824C107.694 15.5419 108.47 15.9487 109.366 15.9487C111.412 15.9487 112.822 14.3756 112.822 11.5072C112.822 8.65924 111.447 7.08606 109.472 7.08606C108.484 7.08606 107.673 7.52683 107.109 8.3541L107.003 7.25559ZM108.837 14.3552C107.729 14.3552 107.165 13.494 107.165 11.5276C107.165 9.54077 107.765 8.67959 108.943 8.67959C110.092 8.67959 110.657 9.54077 110.657 11.5072C110.657 13.494 110.057 14.3552 108.837 14.3552Z" fill="#212328"/>
                                        </g>
                                        <defs>
                                        <linearGradient id="paint0_linear_3_13842" x1="19.2489" y1="18.0004" x2="35.2495" y2="1.99975" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#FFCC00"/>
                                        <stop offset="1" stop-color="#FFE992"/>
                                        </linearGradient>
                                        </defs>
                                    </svg>
                                </div>
                            </a>     
                            
                            <a href="/" class="button-secondary">
                                <div class="button-secondary_caption">
                                    <svg width="108" height="20" viewBox="0 0 108 20" fill="none">
                                        <path d="M4.21289 13.8529C4.71009 14.4703 5.21646 15.2466 5.48146 15.7155C5.80418 16.3251 5.93799 16.7367 6.17806 17.4739C6.31843 17.8777 6.45224 18.0002 6.73297 18.0002C7.03995 18.0002 7.18032 17.7944 7.28789 17.4739C7.51222 16.7823 7.68538 16.2561 7.95956 15.7546C9.01692 13.7748 10.7407 12.368 11.7115 10.4403C11.7115 10.4403 12.3504 9.26283 12.3504 7.61384C12.3504 6.07686 11.7207 5.00879 11.7207 5.00879L4.21683 13.866L4.21289 13.8529Z" fill="#34A853"/>
                                        <path d="M1.66739 10.232C2.27215 11.5996 3.42528 12.798 4.2124 13.853L8.38411 8.9425C8.38411 8.9425 7.79509 9.70838 6.73117 9.70838C5.54525 9.70838 4.57972 8.77056 4.57972 7.58527C4.57972 6.76989 5.06904 6.20459 5.06904 6.20459C1.99929 6.65787 2.16983 7.3964 1.6582 10.2294L1.66739 10.232Z" fill="#FBBC04"/>
                                        <path d="M8.43731 2.25659C9.82788 2.70075 11.0086 3.63727 11.717 5.00492L8.38484 8.95156C8.38484 8.95156 8.87416 8.38366 8.87416 7.57089C8.87416 6.36084 7.84566 5.44778 6.73583 5.44778C5.68241 5.44778 5.08289 6.20454 5.08289 6.20454C5.3387 5.62622 7.9821 2.45327 8.44125 2.25789L8.43731 2.25659Z" fill="#4285F4"/>
                                        <path d="M2.42896 3.99286C3.25805 3.01336 4.71159 2 6.71874 2C7.6882 2 8.42416 2.25529 8.42416 2.25529L5.07891 6.20194C4.85327 6.08042 2.65197 4.37841 2.42896 3.98765V3.99286Z" fill="#1A73E8"/>
                                        <path d="M1.66814 10.2319C1.66814 10.2319 1.12109 9.15343 1.12109 7.60083C1.12109 6.12897 1.70094 4.83947 2.43295 4.00586L5.08291 6.22015L1.67208 10.2319H1.66814Z" fill="#EA4335"/>
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M62.8221 11.8128L66.4196 10.3289C66.2197 9.82847 65.6288 9.48336 64.925 9.48336C64.0256 9.47905 62.7787 10.2685 62.8221 11.8128ZM67.0452 13.2493L68.4181 14.1552C67.975 14.8066 66.9105 15.9282 65.064 15.9282C62.7787 15.9282 61.1277 14.1725 61.1277 11.9336C61.1277 9.5567 62.7917 7.93901 64.8685 7.93901C66.7758 8.00372 67.9619 9.22453 68.4963 10.9328L63.1089 13.1415C63.5216 13.9439 64.1603 14.3537 65.0597 14.3537C65.9547 14.3537 66.5803 13.9137 67.0365 13.2493M58.3036 15.6867H60.0719V3.95303H58.3036V15.6867ZM55.4187 11.9466C55.4187 10.5403 54.4716 9.50925 53.2681 9.50925C52.0516 9.50925 51.0262 10.5403 51.0262 11.9466C51.0262 13.3399 52.0472 14.3537 53.2681 14.3537C54.4759 14.3537 55.4187 13.3399 55.4187 11.9466ZM56.9741 8.18059V15.3415C56.9741 18.2922 55.2232 19.5044 53.1508 19.5044C51.2 19.5044 50.0269 18.2016 49.5838 17.1447L51.1218 16.5106C51.3955 17.162 52.069 17.9342 53.1508 17.9342C55.1276 17.7111 55.3014 16.4416 55.3014 15.0137H55.2363C54.8409 15.4968 54.0762 15.9239 53.116 15.9239C51.1044 15.9239 49.2579 14.1854 49.2579 11.9422C49.2579 9.68611 51.1001 7.93038 53.116 7.93038C54.0762 7.93038 54.8409 8.35314 55.2363 8.82335H55.2971V8.17196C55.2971 8.16764 56.9741 8.16764 56.9741 8.16764V8.18059ZM37.6836 11.9336C37.6836 10.4971 36.6496 9.51356 35.4548 9.51356C34.2556 9.51356 33.2259 10.4971 33.2259 11.9336C33.2259 13.3572 34.26 14.3537 35.4548 14.3537C36.6496 14.3537 37.6836 13.3529 37.6836 11.9336ZM39.4215 11.9336C39.4215 14.2329 37.6402 15.9282 35.4548 15.9282C33.2694 15.9282 31.488 14.2329 31.488 11.9336C31.488 9.61709 33.2694 7.93901 35.4548 7.93901C37.6402 7.93901 39.4215 9.61709 39.4215 11.9336ZM46.5903 11.9336C46.5903 10.4971 45.5562 9.51356 44.3614 9.51356C43.1623 9.51356 42.1326 10.4971 42.1326 11.9336C42.1326 13.3572 43.1666 14.3537 44.3614 14.3537C45.5562 14.3537 46.5903 13.3529 46.5903 11.9336ZM48.3282 11.9336C48.3282 14.2329 46.5468 15.9282 44.3614 15.9282C42.176 15.9282 40.3947 14.2329 40.3947 11.9336C40.3947 9.61709 42.176 7.93901 44.3614 7.93901C46.5468 7.93901 48.3282 9.61709 48.3282 11.9336ZM24.6929 15.9282C21.2519 15.9282 18.3496 13.1415 18.3496 9.71631C18.3496 6.29544 21.2475 3.50439 24.6929 3.50439C26.6002 3.50439 27.9558 4.24637 28.9768 5.21698L27.7733 6.41192C27.0434 5.73033 26.0528 5.19973 24.6929 5.19973C22.1773 5.19973 20.2178 7.21429 20.2178 9.68611C20.2178 12.1838 22.186 14.1725 24.6929 14.1725C26.3222 14.1725 27.2519 13.5211 27.8472 12.9301C28.3338 12.447 28.6553 11.7481 28.7769 10.7948H24.6929V9.09943H30.4279C30.4887 9.4014 30.5192 9.76376 30.5192 10.1563C30.5192 11.4289 30.1672 13.0034 29.042 14.1207C27.9471 15.2639 26.5437 15.8721 24.6972 15.8721" fill="#212328"/>
                                        <path d="M72.6475 15.5976V5.1665H74.0042L77.6528 11.5198H77.7078L81.3564 5.1665H82.7132V15.5976H81.3569L81.4119 7.66051H81.3569L78.075 13.3767H77.2866L74.0047 7.66051H73.9497C74.0498 10.3006 74.0047 12.958 74.0047 15.5976H72.6475ZM86.9485 15.7796C86.1785 15.7796 85.5551 15.5612 85.0417 15.1243C84.5283 14.6874 84.2717 14.1048 84.2717 13.3944C84.2717 12.6117 84.5833 12.0109 85.1884 11.574C85.7934 11.1371 86.5452 10.9187 87.4252 10.9187C88.2136 10.9187 88.8737 11.0643 89.3687 11.3556C89.3555 9.84141 88.3016 9.4259 87.4802 9.4259C86.7047 9.46248 86.0318 9.7845 85.7568 10.4635L84.5283 9.93562C84.6934 9.51692 85.0234 9.11599 85.5184 8.75233C86.0135 8.38868 86.6552 8.2062 87.4619 8.2062C88.3786 8.2062 89.1487 8.47927 89.7537 9.00719C90.3588 9.53512 90.6705 10.2997 90.6705 11.2645V15.579H89.387V14.5959C88.7875 15.3423 87.9771 15.7628 86.9485 15.7792V15.7796ZM89.3687 12.4665C88.5785 11.8693 86.9302 11.7947 86.1601 12.4118C85.5551 12.9944 85.4909 13.7754 86.1235 14.2323C87.6526 15.2062 89.4237 13.6898 89.3687 12.4665ZM95.9325 15.7796C95.3825 15.7796 94.8875 15.6704 94.4658 15.4338C94.0441 15.1971 93.714 14.9058 93.494 14.56H93.4207L93.4757 15.543V18.6923H92.1372V8.40688H93.4207V9.38992H93.4757C93.6957 9.04404 94.0074 8.75277 94.4474 8.51611C94.8875 8.27945 95.3825 8.17022 95.9142 8.17022C96.8493 8.17022 97.6377 8.53431 98.316 9.26249C98.9944 9.99066 99.324 10.9009 99.324 11.9749C99.324 13.049 98.994 13.9592 98.316 14.6874C97.656 15.4156 96.8493 15.7796 95.9325 15.7796ZM95.7125 14.5418C96.3359 14.5418 96.8676 14.3051 97.326 13.8318C97.7843 13.3585 98.0044 12.7395 98.0044 11.9567C98.0044 11.1739 97.7843 10.555 97.326 10.0817C96.8676 9.60837 96.3359 9.37171 95.7125 9.37171C95.0708 9.37171 94.5391 9.60837 94.0991 10.0635C93.659 10.5368 93.439 11.1557 93.439 11.9385C93.439 12.7213 93.659 13.3585 94.0991 13.8136C94.5391 14.3233 95.0708 14.5418 95.7125 14.5418ZM103.266 15.7796C102.46 15.7796 101.8 15.5794 101.286 15.1971C100.755 14.8148 100.388 14.3233 100.131 13.7408L101.341 13.2492C101.726 14.1413 102.368 14.5964 103.285 14.5964C103.706 14.5964 104.055 14.5058 104.311 14.3233C104.587 14.1413 104.715 13.9046 104.715 13.5951C104.715 13.1218 104.385 12.8123 103.725 12.6485L102.276 12.3026C101.818 12.1934 101.378 11.9567 100.975 11.6473C100.571 11.3378 100.351 10.8827 100.351 10.3365C100.351 9.69939 100.626 9.18967 101.195 8.80738C101.763 8.40688 102.423 8.22484 103.193 8.22484C103.835 8.22484 104.403 8.37047 104.898 8.66174C105.393 8.95301 105.76 9.35351 105.962 9.89964L104.788 10.373C104.532 9.7358 103.981 9.42633 103.138 9.42633C102.735 9.42633 102.405 9.51692 102.13 9.68119C101.856 9.84546 101.727 10.0635 101.727 10.3547C101.727 10.7552 102.038 11.0465 102.68 11.1921L104.11 11.5198C104.789 11.6837 105.284 11.9385 105.614 12.3208C105.944 12.7031 106.09 13.1218 106.09 13.5951C106.09 14.2323 105.834 14.7784 105.302 15.1971C104.789 15.5612 104.11 15.7796 103.267 15.7796H103.266Z" fill="#212328"/>
                                    </svg>
                                </div>
                            </a>                  
                        </div>
                    </div>
                </div>`
    };
}

new AppContacts();
